<!DOCTYPE html>
<html>

<head>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript">

        $(document).ready(function() {
           //Beim "Senden" soll folgendes passieren ...
            
            
            $('#teamSelectA').html('<option value="">Bitte Team auswählen</option>');
           $('#teamSelectB').html('<option value="">Bitte Team auswählen</option>');
            
            
         $('#spielerSelect').html('<option value="no">Bitte Spieler auswählen</option>');
        
            var request = $.ajax({
                 type: 'GET',
                 url: '/tget',
                 contentType: 'application/json'
            })
            request.done(function(data) {
                 data.forEach(function(team) {
                     $('#teamSelectA').append('<option value="' + team.name + '">' + team.name + '</option>'); 
                     console.log(team);
                     $('#teamSelectB').append('<option value="' + team.name + '">' + team.name + '</option>'); 
                     console.log(team);
                 });
            })
            request.fail(function(error) {
                 alert('Es ist ein Fehler aufgetreten.');
            });       
          
            
            
            
            $("#teamSelect").submit(function() {

               event.preventDefault();
               var data = 
                    { 	
                        teamA: $('#teamSelectA').val() ,
                        teamB: $('#teamSelectB').val() ,
                        aPunkte: 0,
                        bPunkte: 0
                     };
                     //AJAX - Methode für das POST
                    $.ajax({
                        type: 'POST',
                        url: '/spielStart',
                        data: JSON.stringify(data),	//Datentyp
                        contentType: 'application/json'
                      }).done(function(){	//wenn hinzugefuegt wurde
                        //alert(ereignis);	
                     
                        document.getElementById('eventF').style.display = 'block';
                        document.getElementById('quit').style.display = 'block';
                        document.getElementById('teamSelect').style.display = 'none';
                        
                        spielerSelectAdd($("#teamSelectA").val());
                        spielerSelectAdd($("#teamSelectB").val());
                        

                       
                        
                        
                      }).fail(function(event){	//Fehlermeldung
                        
                        alert(data.teamA+' konnte nicht hinzugefuegt werden!('+JSON.stringify(event)+')');
                      });
            });
            
            $("#eventF").submit(function() {

               event.preventDefault();
                
                if( $('#eventSelect').val() == 'punkte' )
                {
               var data = 
                    { 	
                        name: $('#spielerSelect').val() ,
                        punkte: $('#tick').val() ,
                        teamA: $('#teamSelectA').val() ,
                        teamB: $('#teamSelectB').val() 
                     };
                     //AJAX - Methode für das POST
                    $.ajax({
                        type: 'POST',
                        url: '/spunkte',
                        data: JSON.stringify(data),	//Datentyp
                        contentType: 'application/json'
                      }).done(function(){	//wenn hinzugefuegt wurde
                        alert(data.name+' wurde hinzugefügt!');	
                         $('#ph')[0].reset();	//Formular zurücksetzen
                      }).fail(function(event){	//Fehlermeldung
                        alert(data.name+' konnte nicht hinzugefuegt werden!('+JSON.stringify(event)+')');
                      });
                }
                else
                {
                    
               var data = 
                    { 	
                        tick: $('#tick').val() 
                     };
                     //AJAX - Methode für das POST
                    $.ajax({
                        type: 'POST',
                        url: '/livepost',
                        data: JSON.stringify(data),	//Datentyp
                        contentType: 'application/json'
                      }).done(function(){	//wenn hinzugefuegt wurde
                        alert(data.tick+' wurde hinzugefügt!');	
                         $('#ph')[0].reset();	//Formular zurücksetzen
                      }).fail(function(event){	//Fehlermeldung
                        alert(data.tick+' konnte nicht hinzugefuegt werden!('+JSON.stringify(event)+')');
                      });
                }
            });
            
            
           
            
            
        $('#quit').on('click', function () {
        var data = 
                    { 	
                        teamA: $('#teamSelectA').val(),
                        teamB: $('#teamSelectB').val()
                     };
                     //AJAX - Methode für das POST
                    $.ajax({
                        type: 'POST',
                        url: '/spielEnde',
                        data: JSON.stringify(data),	//Datentyp
                        contentType: 'application/json'
                      }).done(function(){	//wenn hinzugefuegt wurde
                        window.location.replace('tget.html');
                      }).fail(function(event){	//Fehlermeldung
                        alert(data.tick+' konnte nicht hinzugefuegt werden!('+JSON.stringify(event)+')');
                      });
            
          
    });
        
            function spielerSelectAdd(team)
            {
                 var request = $.ajax({
                             type: 'GET',
                             url: '/sget',
                             contentType: 'application/json'
                        })
                        request.done(function(data) {
                             data.forEach(function(spieler) {
                                 if(team==spieler.tname)
                                 {
                                     $('#spielerSelect').append('<option value="' + spieler.sname + '">' +spieler.tname + ' - ' + spieler.sname + '</option>'); 
                                     console.log(spieler);
                                 }
                             });
                        })
                        request.fail(function(error) {
                             alert('Es ist ein Fehler aufgetreten.');
                        });
            }
        
        
        
        
        
        });  
    </script>
</head>
    <body>
        <form id='teamSelect' style='display:block' action='/spielStart' method='POST'>
                 <label>Teamauswahl:</label><br>
            <select id="teamSelectA" name="teamA">
            </select><br>
            <select id="teamSelectB" name="teamB">
            </select>
            <br>
            
                 <br><input id='teamS' type='submit' value='Start' />
                 </form>
    
        <form id='eventF' style='display:none' action='/spunkte' method='POST'>
             <label>Event:</label><br>
    <select id="spielerSelect" name="spieler">
            </select>
            <br>
            <select id="eventSelect" name="event">
                <option value='punkte'>Punkte</option>
                <option value='zusatz'>Manuell</option>
            </select>
         <br>
            <input type='text' id = 'tick' name='tick'/></br>
    
                 <br><input id='eventS' type='submit' value='Eintragen' />
                 </form>
    <br>
            <input id='quit' style='display:none' type='submit' value='Beenden' />
    </body>
</html>
